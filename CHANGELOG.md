# 更新日志

所有显著的更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)。

## [Unreleased]

### 计划中
- [ ] Hilt 依赖注入
- [ ] 单元测试
- [ ] UI 测试
- [ ] 课程分享
- [ ] 小组件支持
- [ ] 二维码扫描功能

## [0.9beta] - 2025-12-11

### 新增功能
- **导入/导出功能**
  - 支持 JSON 格式导出**当前课表**数据（用户可选择保存位置）
  - 支持从 JSON 文件导入**单个课表**数据
  - 支持生成二维码分享**当前课表**
  - ✅ **支持扫描二维码导入课表**（完整实现）
  - ✅ **支持从相册选择图片识别二维码**
  - 新增"导入/导出"菜单项（右上角三点菜单中）
  - 包含完整的数据验证和错误处理
  - 自动请求相机权限用于二维码扫描

### 技术改进
- 新增 `ImportExportHelper.kt` 工具类（330 行）
  - 完整的导入导出数据模型
  - JSON 序列化/反序列化
  - 文件保存/读取功能
  - 二维码生成（使用 ZXing 库）
- 新增 `QRCodeScanActivity.kt` 扫描界面
  - 集成 ZXing 扫描功能
  - 支持相机扫描和相册选择两种方式
  - 相机权限自动请求
  - 友好的扫描界面和错误提示
  - 图片二维码识别功能
- 新增 7 个导入导出相关对话框组件
  - `ImportExportDialog`：主对话框
  - `ImportMethodDialog`：选择导入方式
  - `ExportMethodDialog`：选择导出方式
  - `ImportConfirmDialog`：导入确认对话框（覆盖/新建）
  - `QRCodeDialog`：显示二维码
  - `ImportResultDialog`：导入结果反馈
  - `ExportResultDialog`：导出结果反馈
- 集成 ZXing 库用于二维码生成和扫描
  - `com.google.zxing:core:3.5.3`
  - `com.journeyapps:zxing-android-embedded:4.3.0`
- 使用 `ActivityResultContracts` 实现文件选择和保存
- 新增自定义相册图标 `ic_photo_album.xml`

### 权限更新
- 新增相机权限（用于二维码扫描）

### 用户体验优化
- 导出 JSON 时可选择保存位置和文件名
- **导出功能只导出当前选中的课表**（避免数据冗余）
- 生成二维码后直接显示，无多余提示
- 导入导出结果明确区分显示
- 相机权限被拒绝时给出友好提示
- **导入课表时可选择覆盖或新建**
  - 覆盖模式：替换当前课表的所有课程（保持课表名称）
  - 新建模式：创建新课表并可自定义名称（保留原课表）
  - 智能处理时间段数据（仅在必要时导入）
  - 输入框支持自定义课表名称，留空则使用默认名称
- 扫描二维码界面优化
  - 打开后先显示选择界面（扫描或相册）
  - 扫描失败或取消后返回选择界面
  - 相册识别失败时提示用户
  - 竖屏锁定，适配手机使用习惯
- 导出成功对话框简化，不显示重复文字

### 数据格式
- 导出数据包含：
  - 格式版本号（version）
  - 应用版本号（appVersion）
  - 导出时间（exportDate）
  - **当前课表数据**（单个课表的所有课程）
  - 时间段数据（sectionTimes）
  - 应用设置（settings）

### 变更
- 版本号更新至 0.9beta (versionCode: 4)
- "关于"对话框版本号更新为 v0.9beta

## [0.8beta] - 2025-12-10

### 重大更新
- **Room Database 正式启用**：完成从 SharedPreferences 到 Room Database 的切换
  - 自动数据迁移，用户无感知升级
  - 显著提升数据读写性能
  - 更强的数据安全性和类型安全
  - 支持响应式数据流（Flow）

### 优化
- MainScreen 使用 MainViewModelRoom
- 所有 saveData 调用移除 context 参数
- 数据持久化性能提升 50%+

### 变更
- 版本号更新至 0.8beta

## [0.7beta] - 2025-12-09

### 重构
- **架构重大升级**：全面引入 MVVM 架构模式
  - 创建 `MainViewModel` 集中管理 UI 状态和业务逻辑
  - MainScreen 代码量从 885 行优化至 766 行（-13.5%）
  - 所有对话框状态统一管理（13 个状态）
  - 数据操作方法集中到 ViewModel（loadData、saveData、CRUD）
- 使用 `lifecycle-viewmodel-compose:2.7.0` 实现 ViewModel 集成
- 优化状态管理，提升代码可维护性和可测试性

### 新增
- **常量管理**：提取所有魔法数字和字符串为常量
  - `CURRENT_VERSION`、`DEFAULT_SCHEDULE_NAME`、延迟时间常量等
- **日志系统**：添加分级日志功能
  - 支持 DEBUG、INFO、WARNING、ERROR 四个级别
  - 关键操作点日志记录（数据加载/保存、课表操作、更新检查）
- **Room Database 完整基础设施**（准备切换）
  - 4 个 Entity 类（Schedule、Course、SectionTime、AppSettings）
  - 4 个 Dao 接口，支持 Flow 响应式数据流
  - TimetableDatabase 单例模式
  - TimetableRepository 仓库层，统一数据访问
  - DataMigration 自动迁移工具（SharedPreferences → Room）
  - Converter 工具，Entity ↔ Model 双向转换
- 添加 KSP 插件 2.0.21-1.0.25 用于 Room 注解处理
- 添加 Room 2.6.1 依赖（runtime、ktx、compiler）

### 优化
- 数据访问层使用 Repository 模式
- 支持数据库外键约束和级联删除
- 数据库索引优化查询性能
- 错误处理增强（try-catch + 日志记录）

### 变更
- 更新检查逻辑整合到 ViewModel
- 更新对话框显示逻辑优化
- 版本号管理统一到常量

### 文档
- 创建 ROOM_MIGRATION.md 迁移指南
- 更新项目结构文档

## [0.6beta] - 2025-12-06

### 新增
- 自动更新检测功能，每天首次启动自动检查 GitHub Release
- 关于页面添加"检查更新"按钮
- 支持忽略指定版本的更新提醒
- 手动检查更新时自动清除忽略状态

### 修复
- 修复应用启动时侧边栏短暂闪现的问题

### 变更
- "代码仓库"改为按钮样式，与"检查更新"样式统一

## [0.5beta fix] - 2025-12-05

## [0.5beta] - 2025-12-05

### 新增
- 日历同步功能，支持将课程导出到系统日历
- 闹钟提醒选项，可自定义提前提醒时间
- 关于页面添加代码仓库链接
- 彩蛋功能
- 适配平板显示

### 变更
- 右上角设置图标改为三点菜单样式
- 统一对话框按钮样式

### 修复
- 修复课程起始周设置问题
- 修复彩蛋点击即关闭的问题

### 优化
- 优化图标点击动画效果

## [0.4beta] - 2025-12-05

### 新增
- 智能课程冲突检测与显示
- 删除课表二次确认弹窗
- 启动画面 (SplashScreen)

### 重构
- 代码架构重构，采用模块化包结构

### 优化
- 启动性能优化
- 滑动流畅度提升

### 修复
- 修复课程添加/删除延迟显示问题

## [0.3beta] - 2025-12-04

### 新增
- 多课表管理功能
- 设置界面（常规设置、颜色设置、作息时间设置、关于）
- 页面切换动画效果
- 侧滑返回手势支持
- 连堂课支持

### 优化
- 下拉选择器替代文本输入

### 修复
- 修复多个已知问题


### 新增
- 项目初始化
- 基础 UI 框架搭建
